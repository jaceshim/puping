/*
 DMXzone Google Maps
 Version: 1.2.0
 (c) 2012 DMXzone.com
 @build 17-07-2012 23:39:59
*/
(function(j){j.dmxGoogleMaps=j.fn.gMap;var l={};j.fn.dmxGoogleMaps=function(d){var o=this.selector,i=j.extend(!1,l,d,{});if(i.drawing){var m=i.onComplete;i.onComplete=function(){if(i.extensions&&0<i.extensions.length)for(var d=0;d<i.extensions.length;d++)if(null!=window["dmxGoogleMaps_"+i.extensions[d]+"Load"])window["dmxGoogleMaps_"+i.extensions[d]+"Load"](i[i.extensions[d]],j(o).data("gmap"));m&&m()}}j(this.selector).gMap(i)}})(jQuery);
(function(j){var l=function(){this.markers=[];this.mainMarker=!1;this.icon="http://www.google.com/mapfiles/marker.png"};l.prototype.dist=function(a){return Math.sqrt(Math.pow(this.markers[0].latitude-a.latitude,2)+Math.pow(this.markers[0].longitude-a.longitude,2))};l.prototype.setIcon=function(a){this.icon=a};l.prototype.addMarker=function(a){this.markers[this.markers.length]=a};l.prototype.getMarker=function(){if(this.mainmarker)return this.mainmarker;var a,b;1<this.markers.length?(a=new d.MarkerImage("http://thydzik.com/thydzikGoogleMap/markerlink.php?text="+
this.markers.length+"&color=EF9D3F"),b="cluster of "+this.markers.length+" markers"):(a=new d.MarkerImage(this.icon),b=this.markers[0].title);return this.mainmarker=new d.Marker({position:new d.LatLng(this.markers[0].latitude,this.markers[0].longitude),icon:a,title:b,map:null})};var d=google.maps,o=new d.Geocoder,i=0,m=0,g={},g={init:function(a){var b,c=j.extend({},j.fn.gMap.defaults,a);c.markers&&0<c.markers.length&&null==c.markers[c.markers.length-1]&&c.markers.pop();for(b in j.fn.gMap.defaults.icon)c.icon[b]||
(c.icon[b]=j.fn.gMap.defaults.icon[b]);return this.each(function(){var a=j(this),b=g._getMapCenter.apply(a,[c]);if("fit"==c.zoom)c.zoomFit=!0,c.zoom=g._autoZoom.apply(a,[c]);var f={zoom:c.zoom,center:b,mapTypeControl:c.mapTypeControl,mapTypeControlOptions:{},zoomControl:c.zoomControl,zoomControlOptions:{},panControl:c.panControl,panControlOptions:{},scaleControl:c.scaleControl,scaleControlOptions:{},streetViewControl:c.streetViewControl,streetViewControlOptions:{},mapTypeId:c.maptype,scrollwheel:c.scrollwheel,
maxZoom:c.maxZoom,minZoom:c.minZoom};if(c.controlsPositions.mapType)f.mapTypeControlOptions.position=c.controlsPositions.mapType;if(c.controlsPositions.zoom)f.zoomControlOptions.position=c.controlsPositions.zoom;if(c.controlsPositions.pan)f.panControlOptions.position=c.controlsPositions.pan;if(c.controlsPositions.scale)f.scaleControlOptions.position=c.controlsPositions.scale;if(c.controlsPositions.streetView)f.streetViewControlOptions.position=c.controlsPositions.streetView;f.mapTypeControlOptions.style=
c.controlsStyle.mapType;f.zoomControlOptions.style=c.controlsStyle.zoom;f=new d.Map(this,f);c.log&&console.log("map center is:");c.log&&console.log(b);a.data("$gmap",f);a.data("gmap",{opts:c,gmap:f,markers:[],markerKeys:{},infoWindow:null,clusters:[]});if(0!==c.controls.length)for(b=0;b<c.controls.length;b+=1)f.controls[c.controls[b].pos].push(c.controls[b].div);c.clustering.enabled?(b=a.data("gmap"),b.markers=c.markers,g._renderCluster.apply(a,[]),d.event.addListener(f,"bounds_changed",function(){g._renderCluster.apply(a,
[])})):0!==c.markers.length&&g.addMarkers.apply(a,[c.markers]);g._onComplete.apply(a,[])})},_delayedMode:!1,_onComplete:function(){var a=this.data("gmap"),b=this;if(0!==i)window.setTimeout(function(){g._onComplete.apply(b,[])},100);else{if(g._delayedMode){var c=g._getMapCenter.apply(this,[a.opts,!0]);g._setMapCenter.apply(this,[c]);a.opts.zoomFit&&(c=g._autoZoom.apply(this,[a.opts,!0]),a.gmap.setZoom(c))}a.opts.onComplete()}},_setMapCenter:function(a){var b=this.data("gmap");b.opts.log&&console.log("delayed setMapCenter called");
if(void 0!==b.gmap&&0==i)b.gmap.setCenter(a);else{var c=this;window.setTimeout(function(){g._setMapCenter.apply(c,[a])},100)}},_boundaries:null,_getBoundaries:function(a){var b=a.markers,c,d=1E3,e=-1E3,f=1E3,h=-1E3;if(b){for(c=0;c<b.length;c+=1)if(b[c].latitude&&b[c].longitude){if(d>b[c].latitude)d=b[c].latitude;if(e<b[c].longitude)e=b[c].longitude;if(f>b[c].longitude)f=b[c].longitude;if(h<b[c].latitude)h=b[c].latitude;a.log&&console.log(b[c].latitude,b[c].longitude,d,e,f,h)}g._boundaries={N:d,E:e,
W:f,S:h}}if(-1E3==d)g._boundaries={N:0,E:0,W:0,S:0};return g._boundaries},_getBoundariesFromMarkers:function(){var a=this.data("gmap").markers,b,c=1E3,d=-1E3,e=1E3,f=-1E3;if(a){for(b=0;b<a.length;b+=1)c>a[b].getPosition().lat()&&(c=a[b].getPosition().lat()),d<a[b].getPosition().lng()&&(d=a[b].getPosition().lng()),e>a[b].getPosition().lng()&&(e=a[b].getPosition().lng()),f<a[b].getPosition().lat()&&(f=a[b].getPosition().lat());g._boundaries={N:c,E:d,W:e,S:f}}if(-1E3==c)g._boundaries={N:0,E:0,W:0,S:0};
return g._boundaries},_getMapCenter:function(a,b){var c,n=this,e,f;if(a.markers.length&&("fit"==a.latitude||"fit"==a.longitude))return e=b?g._getBoundariesFromMarkers.apply(this):g._getBoundaries(a),c=new d.LatLng((e.N+e.S)/2,(e.E+e.W)/2),a.log&&console.log(b,e,c),c;if(a.latitude&&a.longitude)return c=new d.LatLng(a.latitude,a.longitude);c=new d.LatLng(0,0);if(a.address)return o.geocode({address:a.address},function(b,c){c===google.maps.GeocoderStatus.OK?g._setMapCenter.apply(n,[b[0].geometry.location]):
a.log&&console.log("Geocode was not successful for the following reason: "+c)}),c;if(0<a.markers.length){f=null;for(e=0;e<a.markers.length;e+=1)if(a.markers[e].setCenter){f=a.markers[e];break}if(null===f)for(e=0;e<a.markers.length;e+=1){if(a.markers[e].latitude&&a.markers[e].longitude){f=a.markers[e];break}a.markers[e].address&&(f=a.markers[e])}if(null===f)return c;if(f.latitude&&f.longitude)return new d.LatLng(f.latitude,f.longitude);f.address&&o.geocode({address:f.address},function(b,c){c===google.maps.GeocoderStatus.OK?
g._setMapCenter.apply(n,[b[0].geometry.location]):a.log&&console.log("Geocode was not successful for the following reason: "+c)})}return c},_renderCluster:function(){var a=this.data("gmap"),b=a.markers,c=a.clusters,d=a.opts,e;for(e=0;e<c.length;e+=1)c[e].getMarker().setMap(null);c.length=0;if(e=a.gmap.getBounds()){var f=e.getNorthEast(),h=e.getSouthWest(),k=[],j=(f.lat()-h.lat())*d.clustering.clusterSize/100;for(e=0;e<b.length;e+=1)b[e].latitude<f.lat()&&b[e].latitude>h.lat()&&b[e].longitude<f.lng()&&
b[e].longitude>h.lng()&&(k[k.length]=b[e]);d.log&&console.log("number of markers "+k.length+"/"+b.length);d.log&&console.log("cluster radius: "+j);for(e=0;e<k.length;e+=1){f=-1;for(b=0;b<c.length&&!(h=c[b].dist(k[e]),h<j&&(f=b,d.clustering.fastClustering));b+=1);-1===f?(b=new l,b.addMarker(k[e]),c[c.length]=b):c[f].addMarker(k[e])}d.log&&console.log("Total clusters in viewport: "+c.length);for(b=0;b<c.length;b+=1)c[b].getMarker().setMap(a.gmap)}else{var i=this;window.setTimeout(function(){g._renderCluster.apply(i)},
1E3)}},_processMarker:function(a,b,c,g){var e=this.data("gmap"),f=e.gmap,h=e.opts,k;void 0===g&&(g=new d.LatLng(a.latitude,a.longitude));if(!b)var j={image:h.icon.image,iconSize:new d.Size(h.icon.iconsize[0],h.icon.iconsize[1]),iconAnchor:new d.Point(h.icon.iconanchor[0],h.icon.iconanchor[1]),infoWindowAnchor:new d.Size(h.icon.infowindowanchor[0],h.icon.infowindowanchor[1])},b=new d.MarkerImage(j.image,j.iconSize,null,j.iconAnchor);c||(new d.Size(h.icon.shadowsize[0],h.icon.shadowsize[1]),j&&j.iconAnchor||
new d.Point(h.icon.iconanchor[0],h.icon.iconanchor[1]));b={position:g,icon:b,title:a.title,map:null,draggable:!0===a.draggable?!0:!1};if(!h.clustering.enabled)b.map=f;k=new d.Marker(b);k.setShadow(c);e.markers.push(k);a.key&&(e.markerKeys[a.key]=k);var i;a.html&&(c={content:"string"===typeof a.html?h.html_prepend+a.html+h.html_append:a.html,pixelOffset:a.infoWindowAnchor},h.log&&console.log("setup popup with data"),h.log&&console.log(c),i=new d.InfoWindow(c),d.event.addListener(k,"click",function(){h.log&&
console.log("opening popup "+a.html);h.singleInfoWindow&&e.infoWindow&&e.infoWindow.close();i.open(f,k);e.infoWindow=i}));if(a.html&&a.popup)h.log&&console.log("opening popup "+a.html),i.open(f,k),e.infoWindow=i;a.onDragEnd&&d.event.addListener(k,"dragend",function(b){h.log&&console.log("drag end");a.onDragEnd(b)})},_geocodeMarker:function(a,b,c){var n=this;o.geocode({address:a.address},function(e,f){f===d.GeocoderStatus.OK?(i-=1,n.data("gmap").opts.log&&console.log("Geocode was successful with point: ",
e[0].geometry.location),g._processMarker.apply(n,[a,b,c,e[0].geometry.location])):(f===d.GeocoderStatus.OVER_QUERY_LIMIT&&(!n.data("gmap").opts.noAlerts&&0===m&&alert("Error: too many geocoded addresses! Switching to 1 marker/s mode."),m+=1E3,window.setTimeout(function(){g._geocodeMarker.apply(n,[a,b,c])},m)),n.data("gmap").opts.log&&console.log("Geocode was not successful for the following reason: "+f))})},_autoZoom:function(a,b){var c=j(this).data("gmap"),d=j.extend({},c?c.opts:{},a),e,f,c=39135.758482;
d.log&&console.log("autozooming map");e=b?g._getBoundariesFromMarkers.apply(this):g._getBoundaries(d);d=111E3*(e.E-e.W)/this.width();f=111E3*(e.S-e.N)/this.height();for(e=2;20>e&&!(d>c||f>c);e+=1)c/=2;return e-2},addMarkers:function(a){var b=this.data("gmap").opts;if(0!==a.length){b.log&&console.log("adding "+a.length+" markers");for(b=0;b<a.length;b+=1)g.addMarker.apply(this,[a[b]])}},addMarker:function(a){var b=this.data("gmap").opts;b.log&&console.log("putting marker at "+a.latitude+", "+a.longitude+
" with address "+a.address+" and html "+a.html);var c=b.icon.image,j=new d.Size(b.icon.iconsize[0],b.icon.iconsize[1]),e=new d.Point(b.icon.iconanchor[0],b.icon.iconanchor[1]),f=new d.Size(b.icon.infowindowanchor[0],b.icon.infowindowanchor[1]),h=b.icon.shadow,k=new d.Size(b.icon.shadowsize[0],b.icon.shadowsize[1]),l=new d.Point(b.icon.shadowanchor[0],b.icon.shadowanchor[1]);a.infoWindowAnchor=f;if(a.icon){if(a.icon.image)c=a.icon.image;a.icon.iconsize&&(j=new d.Size(a.icon.iconsize[0],a.icon.iconsize[1]));
a.icon.iconanchor&&(e=new d.Point(a.icon.iconanchor[0],a.icon.iconanchor[1]));a.icon.infowindowanchor&&new d.Size(a.icon.infowindowanchor[0],a.icon.infowindowanchor[1]);if(a.icon.shadow)h=a.icon.shadow;a.icon.shadowsize&&(k=new d.Size(a.icon.shadowsize[0],a.icon.shadowsize[1]));a.icon.shadowanchor&&(l=new d.Point(a.icon.shadowanchor[0],a.icon.shadowanchor[1]))}c=new d.MarkerImage(c,j,null,e);h=new d.MarkerImage(h,k,null,l);if(a.address){if("_address"===a.html)a.html=a.address;if("_address"==a.title)a.title=
a.address;b.log&&console.log("geocoding marker: "+a.address);i+=1;g._delayedMode=!0;g._geocodeMarker.apply(this,[a,c,h])}else{if("_latlng"===a.html)a.html=a.latitude+", "+a.longitude;if("_latlng"==a.title)a.title=a.latitude+", "+a.longitude;b=new d.LatLng(a.latitude,a.longitude);g._processMarker.apply(this,[a,c,h,b])}},removeAllMarkers:function(){var a=this.data("gmap").markers,b;for(b=0;b<a.length;b+=1)a[b].setMap(null),delete a[b];a.length=0},getMarker:function(a){return this.data("gmap").markerKeys[a]},
fixAfterResize:function(a){var b=this.data("gmap");d.event.trigger(b.gmap,"resize");a&&b.gmap.panTo(new google.maps.LatLng(0,0));b.gmap.panTo(this.gMap("_getMapCenter",b.opts,!0))},setZoom:function(a,b,c){var d=this.data("gmap").gmap;"fit"===a&&(a=g._autoZoom.apply(this,[b,c]));d.setZoom(parseInt(a))},changeSettings:function(a){var b=this.data("gmap"),c=[],d;for(d=0;d<b.markers.length;d+=1)c[d]={latitude:b.markers[d].getPosition().lat(),longitude:b.markers[d].getPosition().lng()};a.markers=c;a.zoom&&
g.setZoom.apply(this,[a.zoom,a]);(a.latitude||a.longitude)&&b.gmap.panTo(g._getMapCenter.apply(this,[a]))},mapclick:function(a){google.maps.event.addListener(this.data("gmap").gmap,"click",function(b){a(b.latLng)})},geocode:function(a,b,c){o.geocode({address:a},function(a,e){e===d.GeocoderStatus.OK?b(a[0].geometry.location):c&&c(a,e)})},getRoute:function(a){var b=this.data("gmap"),c=b.gmap,g=new d.DirectionsRenderer,e=new d.DirectionsService,f={BYCAR:d.DirectionsTravelMode.DRIVING,BYBICYCLE:d.DirectionsTravelMode.BICYCLING,
BYFOOT:d.DirectionsTravelMode.WALKING},h={MILES:d.DirectionsUnitSystem.IMPERIAL,KM:d.DirectionsUnitSystem.METRIC},i=null,l=null,m=null;void 0!==a.routeDisplay?i=a.routeDisplay instanceof jQuery?a.routeDisplay[0]:"string"==typeof a.routeDisplay?j(a.routeDisplay)[0]:null:null!==b.opts.routeFinder.routeDisplay&&(i=b.opts.routeFinder.routeDisplay instanceof jQuery?b.opts.routeFinder.routeDisplay[0]:"string"==typeof b.opts.routeFinder.routeDisplay?j(b.opts.routeFinder.routeDisplay)[0]:null);g.setMap(c);
null!==i&&g.setPanel(i);l=void 0!==f[b.opts.routeFinder.travelMode]?f[b.opts.routeFinder.travelMode]:f.BYCAR;m=void 0!==h[b.opts.routeFinder.travelUnit]?h[b.opts.routeFinder.travelUnit]:h.KM;e.route({origin:a.from,destination:a.to,travelMode:l,unitSystem:m},function(a,c){c==d.DirectionsStatus.OK?g.setDirections(a):null!==i&&j(i).html(b.opts.routeFinder.routeErrors[c])});return this}};j.fn.gMap=function(a){if(g[a])return g[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||
!a)return g.init.apply(this,arguments);j.error("Method "+a+" does not exist on jQuery.gmap")};j.fn.gMap.defaults={log:!1,address:"",latitude:null,longitude:null,zoom:3,maxZoom:null,minZoom:null,markers:[],controls:{},scrollwheel:!0,maptype:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,zoomControl:!0,panControl:!1,scaleControl:!1,streetViewControl:!0,controlsPositions:{mapType:null,zoom:null,pan:null,scale:null,streetView:null},controlsStyle:{mapType:google.maps.MapTypeControlStyle.DEFAULT,zoom:google.maps.ZoomControlStyle.DEFAULT},
singleInfoWindow:!0,html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",iconsize:[20,34],iconanchor:[9,34],infowindowanchor:[9,2],shadow:"http://www.google.com/mapfiles/shadow50.png",shadowsize:[37,34],shadowanchor:[9,34]},onComplete:function(){},routeFinder:{travelMode:"BYCAR",travelUnit:"KM",routeDisplay:null,routeErrors:{INVALID_REQUEST:"The provided request is invalid.",NOT_FOUND:"One or more of the given addresses could not be found.",
OVER_QUERY_LIMIT:"A temporary error occured. Please try again in a few minutes.",REQUEST_DENIED:"An error occured. Please contact us.",UNKNOWN_ERROR:"An unknown error occured. Please try again.",ZERO_RESULTS:"No route could be found within the given addresses."}},clustering:{enabled:!1,fastClustering:!1,clusterCount:10,clusterSize:40}}})(jQuery);
